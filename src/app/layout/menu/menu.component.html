<nav ngbNav [activeId]="(routeUrl | async)?.url" class="navbar navbar-expand-lg navbar-light bg-light">

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mainNav" aria-controls="mainNav"
        aria-expanded="false" aria-label="Toggle navigation" (click)="isCollapsed = !isCollapsed">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="mainNav" [ngbCollapse]="isCollapsed">
        <ul class="navbar-nav mr-auto">
            <li ngbDropdown class="nav-item" role="presentation">
                <button type="button" class="nav-link" ngbDropdownToggle>Dropdown</button>
                <div ngbDropdownMenu>
                    <div [ngbNavItem]="homeLink">
                        <a ngbNavLink [routerLink]="homeLink">Link1 to Home</a>
                    </div>
                    <div class="dropdown-divider"></div>

                    <div ngbDropdown display="dynamic" [placement]="['end-top', 'end']" #dropdown="ngbDropdown"
                        (mouseenter)="openMenu(dropdown)">
                        <button class="" ngbDropdownToggle>
                            Вложенное меню
                        </button>
                        <div ngbDropdownMenu>
                            <button class="dropdown-item" ngbDropdownItem>Пункт вложенного меню 1</button>
                            <button class="dropdown-item" ngbDropdownItem>Пункт вложенного меню 2</button>
                        </div>
                    </div>

                    <div class="dropdown-divider"></div>
                    <button ngbDropdownItem>Action</button>
                    <button ngbDropdownItem>Another action</button>
                    <button ngbDropdownItem>Something else here</button>
                    <div class="dropdown-divider"></div>
                    <button ngbDropdownItem>Separated link</button>
                </div>
            </li>
            <li [ngbNavItem]="page1Link">
                <a ngbNavLink routerLink="/page1">Link1 to page1</a>
            </li>
        </ul>
    </div>

</nav>

<!-- <nav ngbNav [activeId]="(routeUrl | async)?.url" class="navbar navbar-expand-lg navbar-light bg-light">
    Here:
    <ul class="navbar-nav mr-auto">
        1
        <ng-template #menuItemTemplate let-items>
            2
            <li *ngFor="let item of menuItems">
                3
                <ng-container *ngIf="!item.children">
                    4 пришел item {{item.title}}<br>
                    <a href="">{{item.title}}</a>
                </ng-container>
                <ng-container *ngIf="item.children">
                    5 пришел item {{item.title}}<br>
                    {{item | json}}
                    <br>
                    <a href="">{{item.title}} </a>
                    <ng-container *ngTemplateOutlet="menuItemTemplate; context: {$implicit: item.children}">
                    </ng-container>
                </ng-container>
                6
                конец итерации item {{item.title}}<br>
            </li>
        </ng-template>

        <ng-container *ngTemplateOutlet="menuItemTemplate; context: { $implicit: menuItems }"></ng-container>


        -- this is another instance. only ine of them can be uncommented --
        <ng-container *ngFor="let item of menuItems">

            <ng-container *ngIf="item.children">
                <ng-container *ngTemplateOutlet="menuParentItem; context: {$implicit: item}"></ng-container>>
            </ng-container>

            <ng-container *ngIf="!item.children">
                <ng-container *ngTemplateOutlet="menuItem; context: {item: item}"></ng-container>
            </ng-container>



        </ng-container>
    </ul>

    <ul class="menu">
        <ng-template #menuRef let-items>
            <li *ngFor="let item of items">
                <ng-container *ngIf="!item.children">
                    <a [routerLink]="item.route">
                        <img [src]="item?.children > 0 && !item.icon ? '/folder.png' : item.icon" />
                        {{ item.title }}
                    </a>
                </ng-container>
                <ng-container *ngIf="item?.children">

                    <div ngbDropdown display="dynamic" [placement]="['end-top', 'end']" class="d-inline-block">
                        <button class="btn" ngbDropdownToggle>
                            <img [src]="item?.children > 0 && !item.icon ? '/folder.png' : item.icon" />
                            {{ item.title }}
                        </button>

                        <div ngbDropdownMenu>
                            <ul class="submenu">
                                <ng-container
                                    *ngTemplateOutlet="menuRef; context: { $implicit: item.children }"></ng-container>
                            </ul>
                        </div>
                    </div>
                </ng-container>
            </li>
        </ng-template>
        <ng-container *ngTemplateOutlet="menuRef; context: { $implicit: menuItems }"></ng-container>
    </ul>
</nav> -->



<!-- <ng-template #menuItem let-item=" item">
    ChildItem: {{item | json}};
</ng-template> -->

<ng-template #menuItem let-item="item">
    ChildItem: {{item | json}};
    <!-- <li [ngbNavItem]="item.route">
        <a ngbNavLink [routerLink]="item.route">{{item.title}}</a>
    </li><br> -->
</ng-template>

<ng-template #menuParentItem let-item>
    nested items {{item | json}}<br>
</ng-template>